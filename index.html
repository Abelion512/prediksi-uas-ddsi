<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS Dasar-Dasar Sistem Informasi</title>
    <!-- Menggunakan Tailwind CSS untuk styling cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar untuk navigasi soal */
        .question-grid::-webkit-scrollbar {
            width: 6px;
        }
        .question-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .question-grid::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        .option-label {
            transition: all 0.2s;
        }
        .option-radio:checked + .option-label {
            background-color: #ebf8ff; /* blue-50 */
            border-color: #3182ce; /* blue-600 */
            color: #2c5282; /* blue-800 */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-blue-700 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-lg font-bold md:text-xl">UAS Sistem Informasi</h1>
                <p class="text-xs text-blue-200">Simulasi Ujian Akhir Semester</p>
            </div>
            <div id="timer-container" class="hidden bg-blue-800 px-3 py-1 rounded-md border border-blue-500">
                <span class="text-sm font-mono" id="timer">00:00:00</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6 max-w-5xl">
        
        <!-- Halaman Awal (Intro) -->
        <div id="intro-screen" class="bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto text-center">
            <div class="mb-6">
                <svg class="w-20 h-20 mx-auto text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-4">Selamat Datang di Simulasi UAS</h2>
            <p class="text-gray-600 mb-6">
                Mata Kuliah: <strong>Dasar-Dasar Sistem Informasi</strong><br>
                Jumlah Soal: <strong>30 Pilihan Ganda</strong><br>
                Waktu Pengerjaan: <strong>60 Menit</strong>
            </p>
            <ul class="text-left text-sm text-gray-600 bg-blue-50 p-4 rounded-lg mb-8 space-y-2">
                <li class="flex items-start"><span class="mr-2 text-blue-500">✓</span> Materi mencakup Data, SDLC, E-Commerce, & Komponen Sistem.</li>
                <li class="flex items-start"><span class="mr-2 text-blue-500">✓</span> Soal diperbarui dengan referensi modul terbaru.</li>
                <li class="flex items-start"><span class="mr-2 text-blue-500">✓</span> Nilai akan langsung muncul setelah selesai.</li>
                <li class="flex items-start"><span class="mr-2 text-blue-500">✓</span> Progress tersimpan otomatis jika halaman di-reload.</li>
            </ul>
            <button onclick="startExam()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105">
                Mulai Ujian Sekarang
            </button>
        </div>

        <!-- Halaman Ujian -->
        <div id="exam-screen" class="hidden flex flex-col md:flex-row gap-6">
            
            <!-- Area Soal (Kiri) -->
            <div class="w-full md:w-3/4">
                <div class="bg-white rounded-xl shadow-md p-6 min-h-[400px]">
                    <div class="flex justify-between items-center mb-4 border-b pb-4">
                        <span class="text-sm font-semibold text-gray-500">Soal No. <span id="q-number">1</span></span>
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-bold" id="q-status">Belum Dijawab</span>
                    </div>
                    
                    <div id="question-text" class="text-lg font-medium mb-6 leading-relaxed">
                        <!-- Soal akan muncul di sini -->
                    </div>

                    <div id="options-container" class="space-y-3">
                        <!-- Opsi jawaban akan muncul di sini -->
                    </div>
                </div>

                <!-- Navigasi Bawah -->
                <div class="flex justify-between mt-6">
                    <button id="btn-prev" onclick="prevQuestion()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg disabled:opacity-50">
                        &larr; Sebelumnya
                    </button>
                    <button id="btn-next" onclick="nextQuestion()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg">
                        Selanjutnya &rarr;
                    </button>
                    <button id="btn-finish" onclick="confirmFinish()" class="hidden bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg">
                        Selesai Ujian
                    </button>
                </div>
            </div>

            <!-- Sidebar Navigasi Soal (Kanan) -->
            <div class="w-full md:w-1/4">
                <div class="bg-white rounded-xl shadow-md p-4 sticky top-20">
                    <h3 class="font-bold text-gray-700 mb-3 border-b pb-2">Navigasi Soal</h3>
                    <div id="question-grid" class="question-grid grid grid-cols-5 gap-2 max-h-[60vh] overflow-y-auto pr-1">
                        <!-- Grid nomor soal -->
                    </div>
                    <div class="mt-4 pt-3 border-t text-xs text-gray-500 space-y-2">
                        <div class="flex items-center"><div class="w-3 h-3 bg-gray-200 border border-gray-300 rounded mr-2"></div> Belum dijawab</div>
                        <div class="flex items-center"><div class="w-3 h-3 bg-blue-600 rounded mr-2"></div> Sudah dijawab</div>
                        <div class="flex items-center"><div class="w-3 h-3 bg-yellow-400 border border-yellow-500 rounded mr-2"></div> Sedang dibuka</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Halaman Hasil -->
        <div id="result-screen" class="hidden max-w-3xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-8 text-center text-white">
                    <h2 class="text-3xl font-bold mb-2">Hasil Ujian</h2>
                    <p class="opacity-90">Dasar-Dasar Sistem Informasi</p>
                </div>
                
                <div class="p-8 text-center">
                    <div class="flex justify-center items-center mb-6">
                        <div class="w-40 h-40 rounded-full border-8 border-blue-100 flex items-center justify-center bg-blue-50">
                            <div>
                                <span id="final-score" class="text-5xl font-bold text-blue-700">0</span>
                                <span class="block text-sm text-gray-500 mt-1">Skor Akhir</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-8 text-center">
                        <div class="p-4 bg-green-50 rounded-lg">
                            <span class="block text-2xl font-bold text-green-600" id="total-correct">0</span>
                            <span class="text-xs text-gray-600">Benar</span>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <span class="block text-2xl font-bold text-red-600" id="total-wrong">0</span>
                            <span class="text-xs text-gray-600">Salah</span>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <span class="block text-2xl font-bold text-gray-600" id="total-skipped">0</span>
                            <span class="text-xs text-gray-600">Dilewati</span>
                        </div>
                    </div>

                    <div class="flex justify-center gap-4">
                        <button onclick="location.reload()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg">
                            Ulangi Ujian
                        </button>
                        <button id="btn-review" onclick="showReview()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg opacity-50 cursor-not-allowed">
                            Lihat Pembahasan
                        </button>
                    </div>
                    <p id="review-lock-msg" class="text-sm text-red-500 mt-2 hidden">
                        *Pembahasan hanya terbuka jika Anda mengerjakan minimal 15 soal.
                    </p>
                </div>
            </div>
            
            <!-- Area Pembahasan -->
            <div id="review-container" class="mt-8 space-y-6 hidden">
                <h3 class="text-xl font-bold text-gray-800 ml-2">Pembahasan Jawaban</h3>
                <!-- List pembahasan akan di-render di sini -->
            </div>
        </div>

    </main>

    <!-- Modal Konfirmasi Selesai -->
    <div id="modal-confirm" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl">
            <h3 class="text-lg font-bold mb-2">Selesaikan Ujian?</h3>
            <p class="text-gray-600 mb-6">Pastikan Anda sudah memeriksa kembali jawaban Anda. Waktu akan dihentikan dan skor akan dihitung.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Batal</button>
                <button onclick="calculateResult()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Ya, Selesai</button>
            </div>
        </div>
    </div>

    <script>
        // Data Soal Terbaru (Updated)
        const questionsData = [
            {
                id: 1,
                question: "Kumpulan keterangan atau sebuah fakta, simbol, dan terdiri dari fakta yang masih mentah?",
                options: {
                    a: "Data Processing",
                    b: "Informasi",
                    c: "Input",
                    d: "Knowledge",
                    e: "Data"
                },
                correct: "e"
            },
            {
                id: 2,
                question: "Berikut ini adalah contoh dari layanan internet, kecuali?",
                options: {
                    a: "Usenet",
                    b: "E-Mail",
                    c: "FTP (File Transfer Protocol)",
                    d: "Newschat",
                    e: "Telnet"
                },
                correct: "d"
            },
            {
                id: 3,
                question: "Knowledge dalam organisasi berdasarkan content-nya dibedakan menjadi empat. Di bawah ini adalah keempat pembagian yang tepat, kecuali?",
                options: {
                    a: "Procedural knowledge",
                    b: "Structural knowledge",
                    c: "Reasoning knowledge",
                    d: "Linguistic knowledge",
                    e: "Declarative knowledge"
                },
                correct: "b"
            },
            {
                id: 4,
                question: "Yang didefinisikan sebagai linear model yang setiap tahapan, jelas input serta outputnya, adalah?",
                options: {
                    a: "OOP",
                    b: "Structured methods",
                    c: "Rapid application development methods",
                    d: "Direct Method",
                    e: "Object-oriented methods"
                },
                correct: "b"
            },
            {
                id: 5,
                question: "Seseorang ahli dalam menjabarkan permasalahan yang terjadi di sebuah perusahaan atau organisasi berkaitan dengan sistem komputer yang digunakan pada perusahaan tersebut, disebut?",
                options: {
                    a: "Operator",
                    b: "Programmer",
                    c: "Network specialist",
                    d: "System analyst",
                    e: "Business Analyst"
                },
                correct: "d"
            },
            {
                id: 6,
                question: "Berikut adalah termasuk dari bagian physical design yang benar, kecuali?",
                options: {
                    a: "Hardware design",
                    b: "Interface design",
                    c: "Communication design",
                    d: "Software design",
                    e: "Processing design"
                },
                correct: "e"
            },
            {
                id: 7,
                question: "Berikut yang bukan termasuk dari sistem informasi dari Operation Support System, adalah?",
                options: {
                    a: "Decision Support System",
                    b: "Enterprise collaboration",
                    c: "Process Control System",
                    d: "Transaction processing system",
                    e: "Batch Processing System"
                },
                correct: "a"
            },
            {
                id: 8,
                question: "Penggantian sistem dilakukan secara bertahap, per subsistem atau per modul atau per bagian (The Evolutionary Approach), sering disebut dengan?",
                options: {
                    a: "Technical Implementation",
                    b: "Parallel Implementation",
                    c: "Formalized Implementation",
                    d: "Hybrid Implementation",
                    e: "Objective Implementation"
                },
                correct: "d"
            },
            {
                id: 9,
                question: "Berikut ini yang termasuk ke dalam proses SDLC adalah?",
                options: {
                    a: "Use – Analysis - Design - Planning - Implementation",
                    b: "Planning- Analysis -Use - Design- Implementation",
                    c: "Planning - Design - Analysis-Implementation – Use",
                    d: "Planning - Analysis - Design -Implementation – Use",
                    e: "Planning- Analysis - Design - Planning - Implementation"
                },
                correct: "d"
            },
            {
                id: 10,
                question: "Dibawah ini adalah termasuk dari bagian logical design, kecuali? (Pilih komponen fisik)",
                options: {
                    a: "Input design",
                    b: "Output design",
                    c: "Hardware design",
                    d: "Software design",
                    e: "Processing design"
                },
                correct: "c"
            },
            {
                id: 11,
                question: "Penggunaan sistem informasi untuk membantu sebuah perusahaan retail dalam pencatatan pembelian pelanggan, inventaris perusahaan, pencatatan gaji pegawai, termasuk dalam fungsi sistem informasi sebagai?",
                options: {
                    a: "Support business process and operation",
                    b: "Support strategies for decision making",
                    c: "Support strategies for competitive advantage",
                    d: "Support marketing process and operation",
                    e: "Support business decision making"
                },
                correct: "a"
            },
            {
                id: 12,
                question: "Berikut ini adalah pernyataan yang benar mengenai Intangible Costs, kecuali?",
                options: {
                    a: "Biaya-biaya pengembangan yang sulit diukur",
                    b: "Biaya-biaya pengembangan yang termasuk hidden cost",
                    c: "Biaya-biaya pengembangan yang memerlukan usaha keras untuk diukur",
                    d: "Biaya-biaya pengembangan yang mudah diukur",
                    e: "Biaya-biaya pengembangan yang tidak dapat diukur/sulit diukur"
                },
                correct: "d"
            },
            {
                id: 13,
                question: "Orang yang bertanggung jawab untuk memastikan jaringan yang ada pada perusahaan sudah sesuai dengan prosedur yang berlaku:",
                options: {
                    a: "Network specialist",
                    b: "Operator",
                    c: "System analyst",
                    d: "Programmer",
                    e: "Business Analyst"
                },
                correct: "a"
            },
            {
                id: 14,
                question: "Berikut adalah termasuk dari sistem informasi dari Operation Support System, kecuali?",
                options: {
                    a: "Process Control System",
                    b: "Enterprise collaboration",
                    c: "Decision Support System",
                    d: "Transaction processing system",
                    e: "Expert system"
                },
                correct: "c"
            },
            {
                id: 15,
                question: "Berikut ini adalah Beberapa alasan untuk mengubah atau memperbaiki sistem informasi, kecuali?",
                options: {
                    a: "Proses dari System Maintenance",
                    b: "Technical problems with hardware and software",
                    c: "Bugs in systems",
                    d: "New request from organisational stakeholders",
                    e: "Changes in processes"
                },
                correct: "a"
            },
            {
                id: 16,
                question: "Yang biasanya dikenal sebagai otak dari komputer adalah?",
                options: {
                    a: "Motherboard",
                    b: "CPU",
                    c: "Keyboard",
                    d: "Hardware",
                    e: "Data"
                },
                correct: "b"
            },
            {
                id: 17,
                question: "Intranet yang menggunakan fasilitas komunikasi publik (public communication facilities) atau public internet disebut?",
                options: {
                    a: "Externet",
                    b: "Intranet",
                    c: "Internet",
                    d: "Telnet",
                    e: "Extranet"
                },
                correct: "e"
            },
            {
                id: 18,
                question: "Set elemen atau beberapa komponen yang saling berinteraksi untuk mencapai sebuah tujuan tertentu, disebut?",
                options: {
                    a: "Elemen",
                    b: "Processing",
                    c: "Feedbacks",
                    d: "Sistem",
                    e: "Komponen"
                },
                correct: "d"
            },
            {
                id: 19,
                question: "Berikut ini adalah termasuk fungsi dari CBIS, kecuali?",
                options: {
                    a: "Marketing Information System",
                    b: "Manufacturing Information System",
                    c: "Human Resource Information System",
                    d: "Finance Information System",
                    e: "Restore Information System"
                },
                correct: "e"
            },
            {
                id: 20,
                question: "Berikut ini adalah termasuk stakeholder yang dilibatkan dalam pengembangan sistem informasi, kecuali?",
                options: {
                    a: "Kompetitor",
                    b: "External Parties",
                    c: "Clients",
                    d: "End-User",
                    e: "Pemangku Kepentingan"
                },
                correct: "a"
            },
            {
                id: 21,
                question: "Berikut ini adalah hal yang benar berkaitan dengan konsep tacit knowledge, kecuali?",
                options: {
                    a: "expertise",
                    b: "takes short time to learn",
                    c: "Subjective",
                    d: "cognitive",
                    e: "experiential"
                },
                correct: "b"
            },
            {
                id: 22,
                question: "Transaksi yang terjadi ketika bisnis (B1) melakukan penjualan produk ke bisnis lain (B2). B2 kemudian menjual atau memberi produk tersebut ke seseorang yang merupakan customer atau karyawan, disebut?",
                options: {
                    a: "B2B2C",
                    b: "B2B",
                    c: "B2B2B",
                    d: "C2B",
                    e: "B2C"
                },
                correct: "a"
            },
            {
                id: 23,
                question: "Bagian menghilangkan kesalahan-kesalahan yang mungkin terjadi selama proses analisa data, disebut?",
                options: {
                    a: "Kalkulasi",
                    b: "Kategori",
                    c: "Kondensasi",
                    d: "Kontekstualisasi",
                    e: "Koreksi"
                },
                correct: "e"
            },
            {
                id: 24,
                question: "Berikut ini adalah karakteristik dari informasi, kecuali?",
                options: {
                    a: "Simple",
                    b: "Accessible",
                    c: "Accurate",
                    d: "Secure",
                    e: "Inovation"
                },
                correct: "e"
            },
            {
                id: 25,
                question: "RAM adalah singkatan dari?",
                options: {
                    a: "Random Access Marketing",
                    b: "Random Access Memory",
                    c: "Resource Active Memory",
                    d: "Resource Access Memory",
                    e: "Resource Access Marketing"
                },
                correct: "b"
            },
            {
                id: 26,
                question: "Hasil pemrosessan dari data yang telah terkumpul sehingga memiliki arti dalam suatu konteks tertentu?",
                options: {
                    a: "Informasi",
                    b: "Data Contextual",
                    c: "Informasi terukur",
                    d: "Knowledge",
                    e: "Data"
                },
                correct: "a"
            },
            {
                id: 27,
                question: "Penerapan teknologi informasi (TI) untuk kebutuhan organisasi dan manajerial untuk memberikan solusi bisnis, disebut?",
                options: {
                    a: "Management Information System",
                    b: "Business Information System",
                    c: "Transaction Information System",
                    d: "E-Commerce",
                    e: "Decision Support System"
                },
                correct: "b"
            },
            {
                id: 28,
                question: "Hasil pemrosessan dari data yang telah terkumpul sehingga memiliki arti dalam suatu konteks tertentu? (Variasi Opsi)",
                options: {
                    a: "Informasi terukur",
                    b: "Informasi",
                    c: "Knowledge",
                    d: "Data Contextual",
                    e: "Data"
                },
                correct: "b"
            },
            {
                id: 29,
                question: "Berikut ini adalah definisi yang tepat untuk sistem informasi, kecuali?",
                options: {
                    a: "Sistem informasi adalah kumpulan dari banyak komponen yang saling terkait yang tidak bertujuan untuk mewujudkan organisasi",
                    b: "Sistem informasi berfungsi untuk mengumpulkan, memproses, menyimpan, dan mendistribusikan informasi",
                    c: "Sistem informasi adalah sumber daya yang diperlukan untuk menyampaikan informasi",
                    d: "Sistem informasi mendistribusikan informasi untuk mendukung pengambilan keputusan",
                    e: "Sistem informasi berfungsi mewujudkan tujuan dari organisasi"
                },
                correct: "a"
            },
            {
                id: 30,
                question: "Dibawah ini adalah termasuk kelima elemen yang ada pada CBIS, kecuali?",
                options: {
                    a: "Hardware",
                    b: "Data",
                    c: "Teleconference",
                    d: "Software",
                    e: "Telecommunication"
                },
                correct: "c"
            }
        ];

        // State Management
        let currentQuestionIndex = 0;
        let userAnswers = {}; // Format: { questionId: 'a' }
        let timerInterval;
        let timeLeft = 3600; // 60 menit dalam detik
        const MIN_ANSWERS_FOR_REVIEW = 15; // Syarat buka pembahasan
        const STORAGE_KEY_PREFIX = 'uas_sistem_info_v1_'; // Prefix unik untuk app ini

        // DOM Elements
        const screens = {
            intro: document.getElementById('intro-screen'),
            exam: document.getElementById('exam-screen'),
            result: document.getElementById('result-screen')
        };
        const elements = {
            questionText: document.getElementById('question-text'),
            optionsContainer: document.getElementById('options-container'),
            qNumber: document.getElementById('q-number'),
            qStatus: document.getElementById('q-status'),
            btnPrev: document.getElementById('btn-prev'),
            btnNext: document.getElementById('btn-next'),
            btnFinish: document.getElementById('btn-finish'),
            gridContainer: document.getElementById('question-grid'),
            timer: document.getElementById('timer'),
            timerContainer: document.getElementById('timer-container'),
            modal: document.getElementById('modal-confirm')
        };

        // --- CODE YANG DITAMBAHKAN/DIPERBAIKI UNTUK FITUR RELOAD ---

        // 1. Fungsi Init: Dijalankan saat browser dibuka/reload
        function initApp() {
            // Cek apakah ada status 'active' di penyimpanan browser
            const savedStatus = localStorage.getItem(STORAGE_KEY_PREFIX + 'status');
            
            if (savedStatus === 'active') {
                // Ambil data yang tersimpan
                const savedAnswers = localStorage.getItem(STORAGE_KEY_PREFIX + 'answers');
                const savedTime = localStorage.getItem(STORAGE_KEY_PREFIX + 'time');
                const savedIndex = localStorage.getItem(STORAGE_KEY_PREFIX + 'index');

                // Restore ke variabel
                if (savedAnswers) userAnswers = JSON.parse(savedAnswers);
                if (savedTime) timeLeft = parseInt(savedTime);
                
                // Update tampilan Timer langsung (biar tidak 00:00:00)
                updateTimerDisplay();

                // Pindah langsung ke layar ujian
                screens.intro.classList.add('hidden');
                screens.exam.classList.remove('hidden');
                screens.exam.classList.add('flex');
                elements.timerContainer.classList.remove('hidden');
                
                // Mulai timer dan load soal terakhir
                startTimer();
                renderQuestionGrid();
                loadQuestion(savedIndex ? parseInt(savedIndex) : 0);
            }
        }

        // Jalankan initApp saat konten halaman selesai dimuat
        window.addEventListener('DOMContentLoaded', initApp);

        // 2. Helper Update Tampilan Timer (Diekstrak agar bisa dipanggil saat Init)
        function updateTimerDisplay() {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            elements.timer.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            
            // Alert visual jika waktu < 5 menit
            if (timeLeft < 300) {
                elements.timerContainer.classList.remove('bg-blue-800');
                elements.timerContainer.classList.add('bg-red-600', 'animate-pulse');
            }
        }

        // 3. Modifikasi Start Exam: Reset penyimpanan saat mulai baru
        function startExam() {
            // Set data awal ke LocalStorage
            localStorage.setItem(STORAGE_KEY_PREFIX + 'status', 'active');
            localStorage.setItem(STORAGE_KEY_PREFIX + 'answers', JSON.stringify({}));
            localStorage.setItem(STORAGE_KEY_PREFIX + 'time', 3600);
            localStorage.setItem(STORAGE_KEY_PREFIX + 'index', 0);
            
            // Reset variabel lokal
            userAnswers = {};
            timeLeft = 3600;
            
            screens.intro.classList.add('hidden');
            screens.exam.classList.remove('hidden');
            screens.exam.classList.add('flex');
            elements.timerContainer.classList.remove('hidden');
            
            startTimer();
            renderQuestionGrid();
            loadQuestion(0);
        }

        // 4. Modifikasi Timer: Simpan waktu setiap detik
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            updateTimerDisplay(); // Update awal

            timerInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    calculateResult(true); 
                    return;
                }
                timeLeft--;
                
                // SIMPAN WAKTU KE STORAGE
                localStorage.setItem(STORAGE_KEY_PREFIX + 'time', timeLeft);
                
                updateTimerDisplay();
            }, 1000);
        }

        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        // 5. Modifikasi Load Question: Simpan index halaman saat ini
        function loadQuestion(index) {
            currentQuestionIndex = index;
            
            // SIMPAN POSISI HALAMAN
            localStorage.setItem(STORAGE_KEY_PREFIX + 'index', index);

            const data = questionsData[index];

            // Update UI
            elements.qNumber.textContent = index + 1;
            elements.questionText.textContent = data.question;
            
            // Status Badge
            if (userAnswers[data.id]) {
                elements.qStatus.textContent = "Sudah Dijawab";
                elements.qStatus.className = "bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-bold";
            } else {
                elements.qStatus.textContent = "Belum Dijawab";
                elements.qStatus.className = "bg-gray-200 text-gray-600 text-xs px-2 py-1 rounded-full font-bold";
            }

            // Render Options
            elements.optionsContainer.innerHTML = '';
            Object.keys(data.options).forEach(key => {
                const label = document.createElement('label');
                label.className = `flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 option-label ${userAnswers[data.id] === key ? 'border-blue-600 bg-blue-50' : 'border-gray-200'}`;
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'answer';
                input.value = key;
                input.className = 'option-radio form-radio h-5 w-5 text-blue-600 hidden';
                input.checked = userAnswers[data.id] === key;
                
                input.onchange = () => selectAnswer(data.id, key);

                const spanKey = document.createElement('span');
                spanKey.className = `w-8 h-8 flex items-center justify-center rounded-full mr-3 text-sm font-bold border ${userAnswers[data.id] === key ? 'bg-blue-600 text-white border-blue-600' : 'bg-gray-100 text-gray-600 border-gray-300'}`;
                spanKey.textContent = key.toUpperCase();

                const spanText = document.createElement('span');
                spanText.className = 'text-gray-700 flex-1';
                spanText.textContent = data.options[key];

                label.appendChild(input);
                label.appendChild(spanKey);
                label.appendChild(spanText);
                elements.optionsContainer.appendChild(label);
            });

            // Update Buttons State
            elements.btnPrev.disabled = index === 0;
            if (index === questionsData.length - 1) {
                elements.btnNext.classList.add('hidden');
                elements.btnFinish.classList.remove('hidden');
            } else {
                elements.btnNext.classList.remove('hidden');
                elements.btnFinish.classList.add('hidden');
            }

            // Update Grid Active State
            updateGridHighlight();
        }

        // 6. Modifikasi Select Answer: Simpan jawaban user
        function selectAnswer(qId, answer) {
            userAnswers[qId] = answer;
            
            // SIMPAN JAWABAN KE STORAGE
            localStorage.setItem(STORAGE_KEY_PREFIX + 'answers', JSON.stringify(userAnswers));
            
            // Re-render to update UI styles immediately
            loadQuestion(currentQuestionIndex);
            
            // Update grid color
            const gridBtn = document.getElementById(`grid-btn-${currentQuestionIndex}`);
            if (gridBtn) {
                gridBtn.classList.remove('bg-gray-200', 'text-gray-600');
                gridBtn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
            }
        }

        // Navigation
        function nextQuestion() {
            if (currentQuestionIndex < questionsData.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        // Sidebar Grid
        function renderQuestionGrid() {
            elements.gridContainer.innerHTML = '';
            questionsData.forEach((q, index) => {
                const btn = document.createElement('button');
                btn.id = `grid-btn-${index}`;
                btn.textContent = index + 1;
                btn.className = `h-10 w-full rounded border font-medium text-sm transition ${userAnswers[q.id] ? 'bg-blue-600 text-white border-blue-600' : 'bg-gray-200 text-gray-600 border-gray-300 hover:bg-gray-300'}`;
                btn.onclick = () => loadQuestion(index);
                elements.gridContainer.appendChild(btn);
            });
        }

        function updateGridHighlight() {
            // Reset active border on all grid buttons
            Array.from(elements.gridContainer.children).forEach(btn => {
                btn.classList.remove('ring-2', 'ring-yellow-400', 'ring-offset-1');
            });
            // Add to current
            const currentBtn = document.getElementById(`grid-btn-${currentQuestionIndex}`);
            if (currentBtn) {
                currentBtn.classList.add('ring-2', 'ring-yellow-400', 'ring-offset-1');
            }
        }

        // Finishing Exam (Updated: Hapus Validasi Blokir Submit)
        function confirmFinish() {
            // Langsung buka modal tanpa cek jumlah jawaban
            elements.modal.classList.remove('hidden');
        }

        function closeModal() {
            elements.modal.classList.add('hidden');
        }

        function calculateResult(isTimeOut = false) {
            clearInterval(timerInterval);
            closeModal();
            
            // 7. BERSIHKAN STORAGE SETELAH SELESAI
            // Agar jika di-reload kembali ke halaman awal
            localStorage.removeItem(STORAGE_KEY_PREFIX + 'status');
            localStorage.removeItem(STORAGE_KEY_PREFIX + 'answers');
            localStorage.removeItem(STORAGE_KEY_PREFIX + 'time');
            localStorage.removeItem(STORAGE_KEY_PREFIX + 'index');

            if(isTimeOut) alert("Waktu Habis! Jawaban akan dikumpulkan otomatis.");

            let correctCount = 0;
            let wrongCount = 0;
            let emptyCount = 0;

            questionsData.forEach(q => {
                const userAns = userAnswers[q.id];
                if (!userAns) {
                    emptyCount++;
                } else if (userAns === q.correct) {
                    correctCount++;
                } else {
                    wrongCount++;
                }
            });

            const finalScore = (correctCount / questionsData.length) * 100;
            const answeredCount = correctCount + wrongCount;

            // Render Result
            document.getElementById('final-score').textContent = Math.round(finalScore);
            document.getElementById('total-correct').textContent = correctCount;
            document.getElementById('total-wrong').textContent = wrongCount;
            document.getElementById('total-skipped').textContent = emptyCount;

            // Logic Kunci Pembahasan
            const btnReview = document.getElementById('btn-review');
            const msgLock = document.getElementById('review-lock-msg');

            if (answeredCount >= MIN_ANSWERS_FOR_REVIEW) {
                // Buka akses
                btnReview.classList.remove('opacity-50', 'cursor-not-allowed');
                btnReview.classList.add('hover:bg-blue-700');
                btnReview.disabled = false;
                msgLock.classList.add('hidden');
            } else {
                // Kunci akses
                btnReview.classList.add('opacity-50', 'cursor-not-allowed');
                btnReview.classList.remove('hover:bg-blue-700');
                // Simpan status terkunci di properti element untuk dicek di fungsi showReview
                btnReview.dataset.locked = "true"; 
                msgLock.classList.remove('hidden');
                msgLock.textContent = `*Pembahasan terkunci. Anda baru mengerjakan ${answeredCount} soal (Minimal ${MIN_ANSWERS_FOR_REVIEW}).`;
            }

            screens.exam.classList.add('hidden');
            screens.exam.classList.remove('flex');
            elements.timerContainer.classList.add('hidden');
            screens.result.classList.remove('hidden');

            prepareReview();
        }

        function prepareReview() {
            const container = document.getElementById('review-container');
            container.innerHTML = '<h3 class="text-xl font-bold text-gray-800 ml-2 mb-4">Pembahasan Jawaban</h3>';

            questionsData.forEach((q, index) => {
                const userAns = userAnswers[q.id];
                const isCorrect = userAns === q.correct;
                const isSkipped = !userAns;

                const card = document.createElement('div');
                card.className = `p-6 rounded-lg border-l-4 shadow-sm ${isCorrect ? 'bg-green-50 border-green-500' : (isSkipped ? 'bg-gray-50 border-gray-400' : 'bg-red-50 border-red-500')}`;

                let statusText = '';
                if(isCorrect) statusText = '<span class="text-green-700 font-bold">Benar</span>';
                else if(isSkipped) statusText = '<span class="text-gray-600 font-bold">Tidak Dijawab</span>';
                else statusText = '<span class="text-red-600 font-bold">Salah</span>';

                let optionsHtml = '<div class="mt-3 space-y-2">';
                Object.keys(q.options).forEach(key => {
                    let optClass = "p-2 rounded border ";
                    // Logic styling opsi di review
                    if (key === q.correct) {
                        optClass += "bg-green-100 border-green-500 text-green-800 font-semibold"; // Kunci Jawaban
                    } else if (key === userAns && !isCorrect) {
                        optClass += "bg-red-100 border-red-500 text-red-800"; // Jawaban Salah User
                    } else {
                        optClass += "bg-white border-gray-200 text-gray-500";
                    }
                    
                    optionsHtml += `<div class="${optClass} flex"><span class="w-6 text-center mr-2 font-mono">${key.toUpperCase()}.</span> ${q.options[key]} ${key === q.correct ? '✓' : ''}</div>`;
                });
                optionsHtml += '</div>';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-gray-700">No. ${index + 1}</span>
                        ${statusText}
                    </div>
                    <p class="text-gray-800 mb-2 font-medium">${q.question}</p>
                    ${optionsHtml}
                `;
                container.appendChild(card);
            });
        }

        function showReview() {
            const btnReview = document.getElementById('btn-review');
            
            // Cek apakah tombol dikunci
            if (btnReview.dataset.locked === "true") {
                alert("Maaf, Anda tidak dapat melihat pembahasan karena jumlah soal yang dikerjakan kurang dari 15.");
                return;
            }

            document.getElementById('review-container').classList.remove('hidden');
            // Scroll ke bagian review
            document.getElementById('review-container').scrollIntoView({ behavior: 'smooth' });
        }

    </script>
</body>
</html>
